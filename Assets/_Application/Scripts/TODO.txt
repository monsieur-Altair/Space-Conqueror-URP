1. create good state machine
2. refactor services into non-monobeh
3. inject dependencies correctly